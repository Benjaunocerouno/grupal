<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Compras | TechAdmin</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/normalize.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo"><a th:href="@{/admin/dashboard}">Tech<span>Admin</span></a></div>
        
        <div class="nav-menu">
            <ul class="nav-links">
                <li><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                <li><a th:href="@{/admin/pos}">Ventas / POS</a></li> 
                <li><a th:href="@{/admin/inventario}">Inventario</a></li>

                <li th:if="${session.usuario.tipoUsuario.nombreRol == 'ADMIN' or session.usuario.tipoUsuario.nombreRol == 'ADMIN_VENDEDOR'}">
                    <a th:href="@{/admin/compras}" class="active">Compras</a>
                </li>

                <li th:if="${session.usuario.tipoUsuario.nombreRol == 'ADMIN' or session.usuario.tipoUsuario.nombreRol == 'ADMIN_VENDEDOR'}">
                    <a th:href="@{/admin/proveedores}">Proveedores</a>
                </li>

                <li><a th:href="@{/admin/servicios}">Servicios</a></li>
                <li><a th:href="@{/admin/usuarios}">Clientes</a></li>
                <li><a th:href="@{/admin/reportes}">Reportes</a></li>
                <li><a th:href="@{/admin/mantenimiento}">Mantenimiento</a></li>
            </ul>

            <div class="auth-buttons">
                <div style="text-align: right; color: white; margin-right: 10px;">
                    <span style="font-weight: bold; display: block;" th:text="${session.usuario.nombres}">Usuario</span>
                    <small style="color: #cbd5e1;" th:text="${session.usuario.tipoUsuario.nombreRol}">Rol</small>
                </div>
                <a th:href="@{/logout}" class="btn btn-outline" style="border-color: #ef4444; color: #ef4444;">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
        <div class="burger" id="burgerBtn"><i class="fas fa-bars"></i></div>
    </nav>

    <div class="page-wrapper">
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: #1e293b;">Gestión de Compras</h2>
            <a th:href="@{/admin/dashboard}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>

        <div class="content-box">
            
            <div th:if="${exito}" style="background:#dcfce7; color:#166534; padding:10px; margin-bottom:20px; border-radius:5px; border: 1px solid #bbf7d0;">
                <i class="fas fa-check-circle"></i> <span th:text="${exito}"></span>
            </div>
            <div th:if="${error}" style="background:#fee2e2; color:#991b1b; padding:10px; margin-bottom:20px; border-radius:5px; border: 1px solid #fecaca;">
                <i class="fas fa-exclamation-circle"></i> <span th:text="${error}"></span>
            </div>

            <div style="background: #f0fdf4; padding: 25px; border-radius: 8px; border: 1px solid #bbf7d0; margin-bottom: 40px;">
                <h4 style="margin-top: 0; color: #166534; margin-bottom: 15px;">Registrar Nueva Compra</h4>
                
                <form th:action="@{/admin/compras/guardar}" method="post" th:object="${nuevaCompra}">
                    
                    <div class="form-grid">
                        
                        <div>
                            <label style="display:block; margin-bottom:5px; font-weight:bold;">Proveedor</label>
                            <select th:field="*{proveedor}" class="form-control" required style="width: 100%; padding: 8px;">
                                <option value="">-- Seleccione Proveedor --</option>
                                <option th:each="p : ${proveedores}" 
                                        th:value="${p.idproveedor}" 
                                        th:text="${p.razonSocial + ' (RUC: ' + p.ruc + ')'}"></option>
                            </select>
                        </div>

                        <div>
                            <label style="display:block; margin-bottom:5px; font-weight:bold;">N° Comprobante</label>
                            <input type="text" th:field="*{numeroComprobante}" class="form-control" placeholder="Ej: F001-00045" required style="width: 100%; padding: 8px;">
                        </div>

                        <div>
                            <label style="display:block; margin-bottom:5px; font-weight:bold;">Monto Total (S/)</label>
                            <input type="number" step="0.01" min="0" th:field="*{montoTotal}" class="form-control" placeholder="0.00" required style="width: 100%; padding: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right;">
                        <button type="submit" class="btn btn-filled" style="background: #16a34a; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-save"></i> Registrar Compra
                        </button>
                    </div>
                </form>
            </div>

            <hr style="margin: 30px 0; border:0; border-top:1px solid #e2e8f0;">

            <h3 style="margin-bottom: 15px; color: #475569;">Historial de Compras Recientes</h3>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f8fafc; text-align: left;">
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">ID</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Fecha</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Proveedor</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Comprobante</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Responsable</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Monto</th>
                            <th style="padding: 12px; border-bottom: 2px solid #e2e8f0;">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="c : ${compras}" style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px;" th:text="${c.idcompra}">#1</td>
                            <td style="padding: 12px;" th:text="${#temporals.format(c.fechaCompra, 'dd/MM/yyyy HH:mm')}">Fecha</td>
                            
                            <td style="padding: 12px;" th:text="${c.proveedor != null ? c.proveedor.razonSocial : 'Proveedor Eliminado'}">Prov</td>
                            
                            <td style="padding: 12px;" th:text="${c.numeroComprobante}">001</td>
                            <td style="padding: 12px;" th:text="${c.usuario != null ? c.usuario.nombres : 'Desconocido'}">Resp</td>
                            <td style="padding: 12px; font-weight:bold; color: #166534;">S/ <span th:text="${#numbers.formatDecimal(c.montoTotal, 1, 2)}">0.00</span></td>
                            <td style="padding: 12px;">
                                <span style="background:#dbeafe; color:#1e40af; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: bold;" th:text="${c.estado}">COMPLETADO</span>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(compras)}">
                            <td colspan="7" style="text-align:center; padding:30px; color:#64748b;">
                                <i class="fas fa-box-open fa-2x" style="margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                                No se encontraron compras registradas.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script th:src="@{/js/script.js}"></script>
</body>
</html>